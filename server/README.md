### 要准备的东西

#### mysql （必须要）
mysql 在config文件配置，主要是操作数据库表

#### redis  （必须要）
用来存一些缓存、手机短信验证码、用户访问限制频率

#### 小程序appid和密码 （必须）
用来请求获得用户的openid

**如果要二次开发，下面的才需要**
#### 腾讯云的短信发送
如果要绑定用户的手机号 即发短信
你要有发腾讯云短信的配置信息
可以在 【我的-点击头像-绑定手机】体验

#### 腾讯云COS信息配置
这里主要是上传图片的cos配置，可能跟大家的一些域名配置什么的可能不一样
可能这些要去 ./app/utils/TXcos 文件夹下面看看代码实现，适当修改一些为你们自己的，比如有没有自己的域名的cdn域名


#### 如果要上传图片，还要去配置小程序的回调信息



# 接口文档
### 0.1 获取openid

#### 描述

-	 小程序端请求接口获取openid

#### 请求URL

-	 {{url}}/wx/login

#### 请求方式

- **GET**

#### 请求参数

| 参数名    | 类型   | 是否必填 | 说明                           |
| --------- | ------ | -------- | ----------------------------- |
| lg_code | 字符串 | 是       | 小程序对应的登陆码？ |


#### 请求示例
```python
{{url}}/wx/login?lg_code=xxx
```


#### 返回参数

| 参数名    | 类型   | 是否必填 | 说明                           |
| --------- | ------ | -------- | ----------------------------- |
| openid | 字符串 | 是       | 用户对应的openid |
| code | 字符串 | 是       | 响应状态码，200代表成功，4xxx代表出错 |
| openid_token | 字符串 | 是       | 通过此token去请求获取真实的token，用于后续接口的认证 |


#### 返回示例
```python
成功返回：

{
  "openid": "openid",
  "code": 200,
  "openid_token": "xxxxxxxxxxx"
}

失败返回：

	{
	    "error": "errmsg"
	}
 
```


### 0.2 获取token

#### 描述

-	 通过openid获取token，用户第一次获取token的时候会去自动注册一个本openid对应的账号，账号的密码就是openid后六位

#### 请求URL

-	 {{url}}/openid/token

#### 请求方式

- **GET**

#### 请求参数

| 参数名    | 类型   | 是否必填 | 说明                           |
| --------- | ------ | -------- | ----------------------------- |
| openid_token | 字符串 | 是       | 获取openid的时候返回的openid_token |


#### 请求示例
```python
{{url}}/openid/token?openid_token=xxxxxxx
```


#### 返回参数

| 参数名 | 类型   | 是否必填 | 说明                                  |
| ------ | ------ | -------- | ------------------------------------- |
| openid | 字符串 | 是       | 用户对应的openid                      |
| code   | 字符串 | 是       | 响应状态码，200代表成功，4xxx代表出错 |
| token  | 字符串 | 是       | 用于后续接口的认证                    |
| msg  | 字符串 | 是       | 请求接口的返回说明信息                    |


#### 返回示例

```python
成功返回：

{
  "token": "token xxxxx",
  "openid": "openid xxxxx",
  "code": 200,
  "msg": "获取token成功"
}

失败返回：

	{
	    "code": 4000,
	    "msg": "参数不完整"
	}
    {
	    "code": 4001,
	    "msg": "注册用户失败"
	}
    {
	    "code": 4002,
	    "msg": "注册用户失败"
	}
    {
	    "code": 4003,
	    "msg": "请重新登录"
	}
```


### 0.3 网页端登录获取token

#### 描述

-	 用户在网页端等其他端登录获取token，username只能是手机号

#### 请求URL

-	 {{url}}/token/login

#### 请求方式

- **POST**

#### 请求参数

| 参数名    | 类型   | 是否必填 | 说明                           |
| --------- | ------ | -------- | ----------------------------- |
| username | 字符串 | 是       | 手机号    |
| password | 字符串 | 否       | 密码默认是小程序的openid后六位 |


#### 请求示例
```python
	{
	"username":"13251551242",
	"password":"ksjshx",

	}
```




#### 返回参数

| 参数名 | 类型   | 是否必填 | 说明                                  |
| ------ | ------ | -------- | ------------------------------------- |
| code   | 字符串 | 是       | 响应状态码，200代表成功，4xxx代表出错 |
| token  | 字符串 | 是       | 用于后续接口的认证                    |
| msg  | 字符串 | 是       | 请求接口的返回说明信息                    |

#### 返回示例

```python
成功返回：

{
  "token": "tokenxxx",
  "code": 200,
  "msg": "登录成功"
}

失败返回：

	{
	    "code": 4000,
	    "msg": "参数不完整"
	}
    {
	    "code": 4001,
	    "msg": "登录失败"
	}
```


### 0.4 发送手机验证码

#### 描述

-	 用户用来发送手机验证码 可以是绑定手机号的验证码或者注册的验证码

#### 请求URL

-	 {{url}}/sms?token=xxx

#### 请求方式

- **POST**

#### 请求参数

| 参数名    | 类型   | 是否必填 | 说明                           |
| --------- | ------ | -------- | ----------------------------- |
| phone | 字符串 | 是       | 手机号 |


#### 请求示例
```python
	{
	"phone":"13025134531",
	}
```


#### 返回参数

| 参数名 | 类型   | 是否必填 | 说明                                  |
| ------ | ------ | -------- | ------------------------------------- |
| code   | 字符串 | 是       | 响应状态码，200代表成功，4xxx代表出错 |
| msg  | 字符串 | 是       | 请求接口的返回说明信息                    |

#### 返回示例

```python
成功返回：

{
  "code": 200,
  "msg": "发送成功"
}

失败返回：

	{
	    "code": 4000,
	    "msg": "参数不完整"
	}
    {
	    "code": 4003,
	    "msg": "保存短信验证码异常,请稍后在试"
	}
    {
	    "code": 4004,
	    "msg": "发送失败"
	}
    {
	    "code": 4004,
	    "msg": "发送异常"
	}
```


### 0.5 校验手机验证码

#### 描述

-	 用户验证用户验证码正确性并且绑定手机号到user表里面

#### 请求URL

-	 {{url}}/check/sms_code?token=xxx

#### 请求方式

- **POST**

#### 请求参数

| 参数名    | 类型   | 是否必填 | 说明                           |
| --------- | ------ | -------- | ----------------------------- |
| code | 字符串 | 是       | 验证码 |
| phone     | 字符串 | 否       | 手机号                            |


#### 请求示例
```python
	{
	"code":"123123",
	"phone":"13000000000",

	}
```
#### 返回参数

| 参数名 | 类型   | 是否必填 | 说明                                  |
| ------ | ------ | -------- | ------------------------------------- |
| code   | 字符串 | 是       | 响应状态码，200代表成功，4xxx代表出错 |
| msg  | 字符串 | 是       | 请求接口的返回说明信息                    |

#### 返回示例

```python
成功返回：

{
  "code": 200,
  "msg": "绑定手机成功"
}

失败返回：

	{
	    "code": 4000,
	    "msg": "参数不完整"
	}
    {
	    "code": 4001,
	    "msg": "读取真实短信验证码异常"
	}
    {
	    "code": 4002,
	    "msg": "短信验证码失效"
	}
    {
	    "code": 4003,
	    "msg": "短信验证码错误"
	}
```

### 0.6 创建卡集

#### 描述

-	 创建卡集的操作

#### 请求URL

-	 {{url}}/box?token=xxx

#### 请求方式

- **POST**

#### 请求参数

| 参数名   | 类型   | 是否必填 | 说明           |
| -------- | ------ | -------- | -------------- |
| name     | 字符串 | 是       | 卡集的名称     |
| password | 字符串 | 是       | 卡集的访问密码 |
| color | 字符串 | 是       | 卡集的颜色 |


#### 请求示例

```python
{
	"name":"python",
	"password":"123123"，
	"color":"green"
}
```

#### 返回参数

| 参数名 | 类型   | 是否必填 | 说明                                  |
| ------ | ------ | -------- | ------------------------------------- |
| box_id | int | 是       | 创建的卡集的id                      |
| box_name  | 字符串 | 是       | 创建成功的卡集名称                    |
| code   | 字符串 | 是       | 响应状态码，200代表成功，4xxx代表出错 |
| msg  | 字符串 | 是       | 请求接口的返回说明信息                    |

#### 返回示例

```python
{
  "box_id": 9,
  "box_name": "python",
  "code": 200,
  "msg": "创建成功"
}

失败返回：

	{
	    "code": 4000,
	    "msg": "参数不完整"
	}
    {
	    "code": 4001,
	    "msg": "用户不存在或者用户状态异常"
	}
    {
	    "code": 4002,
	    "msg": "创建失败"
	}
    {
	    "code": 4003,
	    "msg": "创建失败"
	}
    {
	    "code": 4010,
	    "msg": "提交含有敏感内容"
	}
```



### 0.7 克隆卡集

#### 描述

-	 克隆卡集，将目标卡集以及对应的卡片复制一份到自己账号上

#### 请求URL

-	 {{url}}/box/clone?token=xxx

#### 请求方式

- **POST**

#### 请求参数

| 参数名   | 类型   | 是否必填 | 说明       |
| -------- | ------ | -------- | ---------- |
| password | 字符串 | 是       | 要克隆的卡集访问密码 |
| box_id   | int    | 是       | 要克隆的卡集id   |

#### 请求示例

```python
{
    "box_id":1,
    "password":"123123"
}
```


#### 返回参数

| 参数名 | 类型   | 是否必填 | 说明                                  |
| ------ | ------ | -------- | ------------------------------------- |
| new_box | int | 是       | 克隆的卡集的新id                      |
| box_name  | 字符串 | 是       | 克隆成功的卡集名称                    |
| code   | 字符串 | 是       | 响应状态码，200代表成功，4xxx代表出错 |
| msg  | 字符串 | 是       | 请求接口的返回说明信息                    |


#### 返回示例

```python
成功返回：

{
  "box_name": "A卡集",
    "new_box": 10，
  "code": 200,
  "msg": "克隆成功"
}

失败返回：
	{
	    "code": 4000,
	    "msg": "参数不完整"
	}
    {
	    "code": 4001,
	    "msg": "用户不存在或者用户状态异常"
	}
    {
	    "code": 4002,
	    "msg": "卡集不存在或者你不是卡集拥有者"
	}
    {
	    "code": 4003,
	    "msg": "提交数据库变更失败"
	}
    {
	    "code": 4004,
	    "msg": "克隆失败"
	}
```





### 0.8 查看卡集士多

#### 描述

-	查看卡集士多（卡集store，卡集商店-分享），查看卡集广场的所有卡集

#### 请求URL

-	 {{url}}/boxes/share/store?token=xxx

#### 请求方式

- **GET**

#### 请求参数

| 参数名    | 类型   | 是否必填 | 说明                           |
| --------- | ------ | -------- | ----------------------------- |
| 	 | 	 |	 |        |

#### 请求示例
```python
-	 {{url}}/boxes/share/store?token=xxx
```
#### 返回参数

| 参数名 | 类型   | 是否必填 | 说明                                  |
| ------ | ------ | -------- | ------------------------------------- |
| new_box | int | 是       | 克隆的卡集的新id                      |
| box_name  | 字符串 | 是       | 克隆成功的卡集名称                    |
| code   | 字符串 | 是       | 响应状态码，200代表成功，4xxx代表出错 |
| msg  | 字符串 | 是       | 请求接口的返回说明信息                    |



#### 返回示例

```python
成功返回：
{
"code":200,
"msg":"查询成功",
"data":[
    {
      "box_id": 9,
      "box_name": "python",
      "password": "密码",
      "box_color": "green",
      "create_time": "2020-08-06",
    }，
    {
      "box_id": 10,
      "box_name": "java",
      "password": "密码",
      "box_color": "green",
      "create_time": "2020-08-06",
    }
]
}


失败返回：

	{
	    "code": 4000,
	    "msg": "参数不完整"
	}
    {
	    "code": 4001,
	    "msg": "用户不存在或者用户状态异常"
	}
    {
	    "code": 4002,
	    "msg": "创建失败"
	}
    {
	    "code": 400,
	    "msg": "创建失败"
	}
```



### 0.9 删除卡集

#### 描述

-	 删除用户手下的某个卡集

#### 请求URL

-	 {{url}}/box?token=xxx

#### 请求方式

- **DELETE**

#### 请求参数

| 参数名   | 类型   | 是否必填 | 说明       |
| -------- | ------ | -------- | ---------- |
| box_id   | int    | 是       | 卡集的id   |


#### 请求示例

```python
{
    "box_id":9
}
```

#### 返回参数

| 参数名 | 类型   | 是否必填 | 说明                                  |
| ------ | ------ | -------- | ------------------------------------- |
| code   | 字符串 | 是       | 响应状态码，200代表成功，4xxx代表出错 |
| msg  | 字符串 | 是       | 请求接口的返回说明信息                    |


#### 返回示例

```python
成功返回：

{
  "code": 200,
  "msg": "删除卡集成功"
}
失败返回：

	{
	    "code": 4000,
	    "msg": "参数不完整"
	}
    {
	    "code": 4001,
	    "msg": "用户不存在或者用户状态异常"
	}
    {
	    "code": 4002,
	    "msg": "卡集不存在或者你不是卡集拥有者"
	}
    {
	    "code": 4003,
	    "msg": "删除卡集失败"
	}
```



### 1.0 修改卡集

#### 描述

-	 修改用户账号下的某个卡集的信息

#### 请求URL

-	 {{url}}/box

#### 请求方式

- **PUT**

#### 请求参数

| 参数名    | 类型   | 是否必填 | 说明                           |
| --------- | ------ | -------- | ----------------------------- |
| box_id | 字符串 | 是       | 要修改的卡集的id       |
| password     | 字符串 | 否       | 修改后的卡集访问密码                            |
| color | 字符串 | 是       | 修改后的卡集的颜色       |
| box_name     | 字符串 | 否       | 修改后的卡集的名称                            |

#### 请求示例
```python
	{
	"box_id":"13",
	"password":"password",
	"color":"green",
	"box_name":"卡集名称",
	}
```
#### 返回示例
```python
成功返回：

{
  "code": 200,
  "msg": "修改卡集成功"
}

失败返回：

	{
	    "code": 4000,
	    "msg": "参数不完整"
	}

    {
	    "code": 4002,
	    "msg": "卡集不存在或者你不是卡集拥有者"
	}
    {
	    "code": 4003,
	    "msg": "修改卡集失败"
	}
    {
	    "code": 4010,
	    "msg": "提交含有敏感内容"
	}
```




### 1.1 创建卡片

#### 描述

-	 创建卡片，创建卡片前需要有卡集

#### 请求URL

-	 {{url}}/card

#### 请求方式

- **POST**

#### 请求参数

| 参数名    | 类型   | 是否必填 | 说明                           |
| --------- | ------ | -------- | ----------------------------- |
| question | 字符串 | 是       | 卡片的问题       |
| answer     | 字符串 | 否       | 卡片的答案（文字版）   |
| answer_html | 字符串 | 是       | 卡片的答案（html版）  |
| delta     | 字符串 | 否       | 卡片的答案（editor对象版）    |
| box_id | 字符串 | 是       | 所属的卡集的id    |
| color     | 字符串 | 否       | 卡片的颜色  |

#### 请求示例
```python
	{
	"question":"问题",
	"answer":"答案",
	"answer_html":"答案",
	"delta":"答案",
	"box_id":16,
	"color":"green"
	}
```
#### 返回示例

```python
成功返回：

{
  "card_id": 118,
  "card_question": "卡片问题",
  "code": 200,
  "msg": "创建成功"
}
失败返回：

{
"code": 4000,
"msg": "参数不完整"
}
{
"code": 4001,
"msg": "用户不存在或者用户状态异常"
}
{
"code": 4002,
"msg": "卡集不存在或者你不是卡集拥有者"
}
{
"code": 4003,
"msg": "提交数据失败。数据库出现异常"
}
{
"code": 4004,
"msg": "创建失误"
}
```



### 1.2 修改卡片

#### 描述

-	 将存在的卡片修改变动

#### 请求URL

-	 {{url}}/card

#### 请求方式

- **PUT**

#### 请求参数

| 参数名    | 类型   | 是否必填 | 说明         |
| --------- | ------ | -------- | ------------ |
| question | 字符串 | 是       | 修改后的卡片的问题       |
| color     | 字符串 | 否       | 修改后的卡片的颜色  |
| answer     | 字符串 | 否       | 修改后的卡片的答案（文字版）   |
| answer_html | 字符串 | 是       | 修改后的卡片的答案（html版）  |
| delta     | 字符串 | 否       | 修改后的卡片的答案（editor对象版）    |
| box_id | 字符串 | 是       | 所属的卡集的id    |
| card_id | 字符串 | 是       | 修改的卡片的id    |

#### 请求示例

```python
{
    "question":"尝试修改问题并且把类型改了",
    "color":"我不想写这么多东西了",
    "answer":1,
    "answer_html":9,
    "delta":12312312312，
    "box_id":"尝试修改问题并且把类型改了",
    "card_id":"我不想写这么多东西了"
}
```

#### 返回示例

```python
成功返回：

{
    "code": 200,
    "msg": "修改成功",
    "card_id":1
}

失败返回：

{
    "code": 4000,
    "msg": "参数不完整"
}
{
    "code": 4001,
    "msg": "用户不存在或者用户状态异常"
}
{
    "code": 4002,
    "msg": "卡集不存在或者你不是卡集拥有者"
}
{
    "code": 4003,
    "msg": "找不到此卡片"
}
{
    "code": 4004,
    "msg": "修改卡失败"
}
{
    "code": 4005,
    "msg": "提交数据库变更失败"
}
{
    "code": 4006,
    "msg": "提交数据库变更失败"
}
{
    "code": 4010,
    "msg": "提交含有敏感内容"
}
```



### 1.3 删除卡片

#### 描述

- 删除卡集下的某张卡片

#### 请求URL

- {{url}}/card

#### 请求方式

- **DELETE**

#### 请求参数

| 参数名  | 类型 | 是否必填 | 说明     |
| ------- | ---- | -------- | -------- |
| box_id  | int  | 是       | 卡片所属卡集的id |
| card_id | int  | 是       | 卡片的id |


#### 请求示例

```python
{
    "box_id":1,
    "card_id":2
}
```

#### 返回示例

```python
成功返回：

{
  "code": 200,
  "delete_amount": 1,
  "msg": "操作删除卡片成功"
}

失败返回：
    {
        "code": 4000,
        "msg": "参数不完整"
    }
    {
        "code": 4001,
        "msg": "用户不存在或者用户状态异常"
    }
    {
        "code": 4002,
        "msg": "卡集不存在或者你不是卡集拥有者"
    }
    {
        "code": 4003,
        "msg": "操作删除卡片失败"
    }

```



### 1.5 标记卡片状态

#### 描述

-	 标记卡片的状态为掌握或者未掌握

#### 请求URL

-	 {{url}}/card/status

#### 请求方式

- **PUT**

#### 请求参数

| 参数名    | 类型   | 是否必填 | 说明         |
| --------- | ------ | -------- | ------------ |
| box_id | int | 是       | 卡集的id|
| status     | 字符串 | 是      | 要标记的状态       |
| card_id | int | 是       | 卡片的id |

#### 请求示例

```python
{
    "box_id":1,
    "status":"understand",
    "card_id":6
}
```

#### 返回示例

```python
成功返回：

{
  "code": 200,
  "msg": "操作成功"
}

失败返回：

	{
	    "code": 4000,
	    "msg": "参数不完整"
	}
    {
	    "code": 4001,
	    "msg": "用户不存在或者用户状态异常"
	}
     {
	    "code": 4002,
	    "msg": "卡集不存在或者你不是卡集拥有者"
	}
    {
	    "code": 4003,
	    "msg": "找不到对应卡片"
	}
    {
	    "code": 4004,
	    "msg": "参数错误"
	}
    {
	    "code": 4004,
	    "msg": "提交数据操作失败"
	}
    {
	    "code": 4005,
	    "msg": "操作失败"
	}

```


### 1.6  获取卡片

#### 描述

-	 根据参数选择查看卡片的内容和顺序

#### 请求URL

-	 {{url}}/cards

#### 请求方式

- **GET**

#### 请求参数

| 参数名    | 类型   | 是否必填 | 说明         |
| --------- | ------ | -------- | ------------ |
| all_box_id | int | 是       | 要查询的卡集的id数组，如果值是"all"将查询的是全部卡集， |
| card_status | 字符串 | 是       | 状态： 掌握的卡片  没掌握的卡片 全部   [ "understand", "un_understand", "all"] |
| order     | 字符串 | 否       | 排序：随机 顺序 倒序 错误次数   ["random", "up", "down", "error_times"] |
| page | int | 是       | 页数：分页 |
| limit     | int | 否       | 显示数量：一页显示的数量 |


#### 请求示例

```python
	{
	"127.0.0.1:5000/cards?all_box_id=[1,2,3,4,5,6]&card_type=all&card_status=all&order=down&page=1&limit=5"
	}
	
   {
	"127.0.0.1:5000/cards?all_box_id=all&card_type=all&card_status=all&order=down&page=1&limit=5"
	}
```

#### 返回示例

```python
成功返回：
{
  "code": 200,
  "data": [
    {
    "box_id": 1,
    "box_name":"所属卡集的名称",
    "card_id":1,
    "card_color": "卡片的颜色",
    "question": "卡片的问题",
    "answer":"卡片的答案、知识点（纯文本）",
    "delta": "卡片的答案、知识点（delta对象）",
    "understand": True,
    "collection": True
    },
    {
    "box_id": 1,
    "box_name":"所属卡集的名称",
    "card_id":1,
    "card_color": "卡片的颜色",
    "question": "卡片的问题",
    "answer":"卡片的答案、知识点（纯文本）",
    "delta": "卡片的答案、知识点（delta对象）",
    "understand": True,
    "collection": True
    },
    {
    "box_id": 1,
    "box_name":"所属卡集的名称",
    "card_id":1,
    "card_color": "卡片的颜色",
    "question": "卡片的问题",
    "answer":"卡片的答案、知识点（纯文本）",
    "delta": "卡片的答案、知识点（delta对象）",
    "understand": True,
    "collection": True
    },
    {
    "box_id": 1,
    "box_name":"所属卡集的名称",
    "card_id":1,
    "card_color": "卡片的颜色",
    "question": "卡片的问题",
    "answer":"卡片的答案、知识点（纯文本）",
    "delta": "卡片的答案、知识点（delta对象）",
    "understand": True,
    "collection": True
    },
    {
    "box_id": 1,
    "box_name":"所属卡集的名称",
    "card_id":1,
    "card_color": "卡片的颜色",
    "question": "卡片的问题",
    "answer":"卡片的答案、知识点（纯文本）",
    "delta": "卡片的答案、知识点（delta对象）",
    "understand": True,
    "collection": True
    }
  ],
  "msg": "查询成功"
}
失败返回：


	{
	    "code": 4000,
	    "msg": "参数不完整"
	}
    {
	    "code": 4001,
	    "msg": "用户不存在或者用户状态异常"
	}
    {
	    "code": 4002,
	    "msg": "卡集不存在或者你不是卡集拥有者"
	}
```




### 0.5 查看所有卡集

#### 描述

-	 查看本用户下的所有卡集

#### 请求URL

-	 {{url}}/boxes

#### 请求方式

- **POST**

#### 请求参数

| 参数名 | 类型   | 是否必填 | 说明   |
| ------ | ------ | -------- | ------ |
| phone  | 字符串 | 否       | 手机号 |


#### 请求示例

```python
{
    "phone":12312312312
}
```

#### 返回示例

```python
成功返回：

{
  "code": 200,
  "data": [
    {
      "box_id": 1,
      "box_name": "A卡集",
      "create_time": "2020-07-10 23:47:35",
      "password": "123123"
    },
    {
      "box_id": 2,
      "box_name": "B卡集",
      "create_time": "2020-07-10 23:47:40",
      "password": "123123"
    },
    {
      "box_id": 3,
      "box_name": "C卡集",
      "create_time": "2020-07-10 23:47:46",
      "password": "123123"
    }
  ],
  "msg": "查询成功"
}

失败返回：

	{
	    "code": 4000,
	    "msg": "参数不完整"
	}
    {
	    "code": 4001,
	    "msg": "用户不存在或者用户状态异常"
	}
    {
	    "code": 4002,
	    "msg": "查询出错"
	}

```








